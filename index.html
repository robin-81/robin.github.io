<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>快眠ゴリラ心理クイズ</title>
  <style>
    :root { --pink:#ffeef5; --ink:#222; --muted:#666; }
    *{box-sizing:border-box}
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; background:var(--pink); color:var(--ink); }
    .wrap { max-width:860px; margin:auto; padding:24px; min-height:100vh; display:flex; flex-direction:column; }
    header { text-align:center; margin-bottom:16px; }
    h1 { font-size:clamp(22px, 3.2vw, 34px); margin:8px 0; }
    p.lead { color:var(--muted); margin:0 0 8px; }
    .card { background:#fff; border-radius:16px; padding:20px; box-shadow:0 6px 18px rgba(0,0,0,.06); }
    .qtitle { font-size:clamp(18px, 2.6vw, 22px); font-weight:700; line-height:1.4; margin:0 0 14px; }
    .grid { display:grid; grid-template-columns:1fr; gap:10px; }
    @media(min-width:720px){ .grid{ grid-template-columns:repeat(3,1fr);} }
    .choice { text-align:left; border:1px solid #eee; background:#fff; border-radius:14px; padding:14px; cursor:pointer; transition:.15s; box-shadow:0 2px 6px rgba(0,0,0,.04); }
    .choice:hover { background:#ffd7e7; transform:translateY(-1px); }
    .ckey { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; color:#888; font-size:12px; letter-spacing:.08em; }
    .label { font-weight:600; margin-top:4px; }
    .foot { margin-top:14px; padding-top:12px; border-top:1px solid #eee; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; color:#666; font-size:13px;}
    .btn { appearance:none; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; }
    .btn-outline { background:#fff; border:1px solid #ddd; }
    .btn-ghost { background:transparent; }
    .center { text-align:center; }
    .result h2 { font-size:clamp(22px,3vw,28px); margin:10px 0 6px; }
    .result p { margin:6px 0; color:#555; }
    .cta { display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; background:#000; color:#fff; text-decoration:none; }
    .note { text-align:center; color:#777; font-size:12px; margin-top:10px; }
    progress { width:100%; height:8px; accent-color:#ff7aaa; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>快眠ゴリラ心理クイズ</h1>
    </header>

    <div class="card">
      <div id="meta">
        <div id="status" style="font-weight:600;margin-bottom:6px;">Q1 / 3</div>
        <progress id="bar" max="3" value="1"></progress>
      </div>

      <div id="stage" style="margin-top:16px;"></div>

      <div class="foot">
        <div>このページのURLを配れば、全員が同時に回答できます。</div>
        <div>
          <button id="copy" class="btn btn-outline">結果リンクをコピー</button>
          <button id="reset" class="btn btn-ghost">やり直す</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    // ====== データ ======
    const QUESTIONS = [
      { id:"q1", title:"理想の“眠りの森”をイメージしてください。どんな場所で眠りたい？",
        choices:[{key:"A",label:"木々の間を抜ける涼しい風が心地よい森"},
                 {key:"B",label:"小川のせせらぎが静かに響く森"},
                 {key:"C",label:"やわらかな焚き火のそばで安心できる森"}] },
      { id:"q2", title:"布団に入ったとき、つい考えてしまうことは？",
        choices:[{key:"A",label:"今日もよく歩いたな…足の重さが気になる"},
                 {key:"B",label:"明日も元気でいたいな…体調を整えたい"},
                 {key:"C",label:"やっぱり心を落ち着けて眠りたい"}] },
      { id:"q3", title:"理想の眠りに近いイメージは？",
        choices:[{key:"A",label:"脚がすっと軽くなって深く眠れる"},
                 {key:"B",label:"じんわりリラックスして自然と眠りに落ちる"},
                 {key:"C",label:"安心感に包まれて心地よく眠れる"}] },
    ];
const PRODUCTS = {
  A:{ name:"ゴリラのひとつかみ（ふくらはぎケア）", tagline:"脚が軽くなると、眠りは深くなる。", type:"リフレッシュ快眠タイプ",
     url:"https://e-doshisha.com/hanako/gorilla_hitotsukami/"},
  B:{ name:"ゴリラのひとつき（足うらケア）", tagline:"ツボをじんわり、自然にとろける入眠に。", type:"リラックス快眠タイプ",
     url:"https://e-doshisha.com/hanako/gorilla_hitotsuki/"},
  C:{ name:"ゴリラの握手（手ケア）", tagline:"ぬくもりの安心感で、すっと夢の中へ。", type:"安心快眠タイプ",
     url:"https://e-doshisha.com/hanako/gorilla_akushu/"},
};

    // ====== 状態 ======
    const stage = document.getElementById("stage");
    const bar = document.getElementById("bar");
    const statusEl = document.getElementById("status");
    const copyBtn = document.getElementById("copy");
    const resetBtn = document.getElementById("reset");

    const qs = new URLSearchParams(location.search);
    const preset = (qs.get("a") || qs.get("answers") || "").toUpperCase();
    const answers = {};
    if (preset) [...preset].forEach((ch, i)=>{ if("ABC".includes(ch)) answers[QUESTIONS[i].id]=ch; });

    let step = Object.keys(answers).length;

    function chooseResult(ans){
      const count = {A:0,B:0,C:0};
      Object.values(ans).forEach(k=>count[k]++);
      const max = Math.max(count.A, count.B, count.C);
      const cands = ["A","B","C"].filter(k=>count[k]===max);
      if (cands.length>1){
        for(const q of QUESTIONS){ const k = ans[q.id]; if(cands.includes(k)) return k; }
      }
      return cands[0];
    }
    const enc = (ans)=> QUESTIONS.map(q=>ans[q.id]||"").join("");

    function renderQuestion(i){
      statusEl.textContent = `Q${i+1} / ${QUESTIONS.length}`;
      bar.value = i+1;
      const q = QUESTIONS[i];
      stage.innerHTML = `
        <div class="qtitle">${q.title}</div>
        <div class="grid">
          ${q.choices.map(c=>`
            <button class="choice" data-k="${c.key}">
              <div class="ckey">${c.key}</div>
              <div class="label">${c.label}</div>
            </button>`).join("")}
        </div>`;
      stage.querySelectorAll(".choice").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          answers[q.id] = btn.dataset.k;
          step++;
          if (step>=QUESTIONS.length) return renderResult();
          renderQuestion(step);
          syncUrl();
        });
      });
    }

    function renderResult(){
      const key = chooseResult(answers);
      const p = PRODUCTS[key];
      statusEl.textContent = "結果";
      bar.value = bar.max;
      stage.innerHTML = `
        <div class="center result">
          <div style="font-size:46px">🦍✨</div>
          <h2>あなたは「${p.type}」</h2>
          <p>おすすめ：<strong>${p.name}</strong></p>
          <p style="color:#777">${p.tagline}</p>
          <p class="center" style="margin-top:10px">
          <a class="cta" href="${p.url}" target="_blank" rel="noreferrer">商品ページを見る</a>
          </p>
          <div class="note">URLパラメータ「?a=ABC」で結果を再現できます（例：A=Q1、B=Q2、C=Q3）。</div>
        </div>`;
      syncUrl();
    }

    function syncUrl(){
      const code = enc(answers);
      const n = new URL(location.href);
      if (code) n.searchParams.set("a", code); else n.searchParams.delete("a");
      history.replaceState({}, "", n.toString());
    }

    // 初期表示
    if (step>=QUESTIONS.length) renderResult(); else renderQuestion(step);

    // 共有＆リセット
    copyBtn.addEventListener("click", async ()=>{
      try { await navigator.clipboard.writeText(location.href); alert("リンクをコピーしました！"); }
      catch { prompt("コピーできない場合は手動で選択してください", location.href); }
    });
    resetBtn.addEventListener("click", ()=>{
      location.href = location.pathname; // クエリもクリアして最初から
    });
  </script>
</body>
</html>
