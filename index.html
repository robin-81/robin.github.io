<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å¿«çœ ã‚´ãƒªãƒ©å¿ƒç†ã‚¯ã‚¤ã‚º</title>
  <style>
    :root { --pink:#ffeef5; --ink:#222; --muted:#666; }
    *{box-sizing:border-box}
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; background:var(--pink); color:var(--ink); }
    .wrap { max-width:860px; margin:auto; padding:24px; min-height:100vh; display:flex; flex-direction:column; }
    header { text-align:center; margin-bottom:16px; }
    h1 { font-size:clamp(22px, 3.2vw, 34px); margin:8px 0; }
    .card { background:#fff; border-radius:16px; padding:20px; box-shadow:0 6px 18px rgba(0,0,0,.06); }
    .qtitle { font-size:clamp(18px, 2.6vw, 22px); font-weight:700; line-height:1.4; margin:0 0 14px; }
    .grid { display:grid; grid-template-columns:1fr; gap:10px; }
    @media(min-width:720px){ .grid{ grid-template-columns:repeat(3,1fr);} }
    .choice { text-align:left; border:1px solid #eee; background:#fff; border-radius:14px; padding:14px; cursor:pointer; transition:.15s; box-shadow:0 2px 6px rgba(0,0,0,.04); }
    .choice:hover { background:#ffd7e7; transform:translateY(-1px); }
    .ckey { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; color:#888; font-size:12px; letter-spacing:.08em; }
    .label { font-weight:600; margin-top:4px; }
    .foot { margin-top:14px; padding-top:12px; border-top:1px solid #eee; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; color:#666; font-size:13px;}
    .btn { appearance:none; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; }
    .btn-primary { background:#ff4081; color:#fff; }
    .btn-outline { background:#fff; border:1px solid #ddd; }
    .btn-ghost { background:transparent; }
    .center { text-align:center; }
    .result h2 { font-size:clamp(22px,3vw,28px); margin:10px 0 6px; }
    .result p { margin:6px 0; color:#555; }
    .cta { display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; background:#000; color:#fff; text-decoration:none; }
    progress { width:100%; height:8px; accent-color:#ff7aaa; }
    .intro-hero { font-size:56px; }
    .muted { color:#777; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>å¿«çœ ã‚´ãƒªãƒ©å¿ƒç†ã‚¯ã‚¤ã‚º</h1>
    </header>

    <div class="card">
      <div id="meta">
        <div id="status" style="font-weight:600;margin-bottom:6px;"></div>
        <progress id="bar" max="3" value="1" style="display:none;"></progress>
      </div>

      <div id="stage" style="margin-top:16px;"></div>

      <div class="foot" id="foot" style="display:none;">
        <div>ã“ã®ãƒšãƒ¼ã‚¸ã®URLã‚’é…ã‚Œã°ã€å…¨å“¡ãŒåŒæ™‚ã«å›ç­”ã§ãã¾ã™ã€‚</div>
        <div>
          <button id="copy" class="btn btn-outline">çµæœãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
          <button id="reset" class="btn btn-ghost">ã‚„ã‚Šç›´ã™</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== ãƒ‡ãƒ¼ã‚¿ ======
    const QUESTIONS = [
      { id:"q1", title:"ç†æƒ³ã®â€œçœ ã‚Šã®æ£®â€ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¦ãã ã•ã„ã€‚ã©ã‚“ãªå ´æ‰€ã§çœ ã‚ŠãŸã„ï¼Ÿ",
        choices:[{key:"A",label:"æœ¨ã€…ã®é–“ã‚’æŠœã‘ã‚‹æ¶¼ã—ã„é¢¨ãŒå¿ƒåœ°ã‚ˆã„æ£®"},
                 {key:"B",label:"å°å·ã®ã›ã›ã‚‰ããŒé™ã‹ã«éŸ¿ãæ£®"},
                 {key:"C",label:"ã‚„ã‚ã‚‰ã‹ãªç„šãç«ã®ãã°ã§å®‰å¿ƒã§ãã‚‹æ£®"}] },
      { id:"q2", title:"å¸ƒå›£ã«å…¥ã£ãŸã¨ãã€ã¤ã„è€ƒãˆã¦ã—ã¾ã†ã“ã¨ã¯ï¼Ÿ",
        choices:[{key:"A",label:"ä»Šæ—¥ã‚‚ã‚ˆãæ­©ã„ãŸãªâ€¦è¶³ã®é‡ã•ãŒæ°—ã«ãªã‚‹"},
                 {key:"B",label:"æ˜æ—¥ã‚‚å…ƒæ°—ã§ã„ãŸã„ãªâ€¦ä½“èª¿ã‚’æ•´ãˆãŸã„"},
                 {key:"C",label:"ã‚„ã£ã±ã‚Šå¿ƒã‚’è½ã¡ç€ã‘ã¦çœ ã‚ŠãŸã„"}] },
      { id:"q3", title:"ç†æƒ³ã®çœ ã‚Šã«è¿‘ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ï¼Ÿ",
        choices:[{key:"A",label:"è„šãŒã™ã£ã¨è»½ããªã£ã¦æ·±ãçœ ã‚Œã‚‹"},
                 {key:"B",label:"ã˜ã‚“ã‚ã‚Šãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦è‡ªç„¶ã«çœ ã‚Šã«è½ã¡ã‚‹"},
                 {key:"C",label:"å®‰å¿ƒæ„Ÿã«åŒ…ã¾ã‚Œã¦å¿ƒåœ°ã‚ˆãçœ ã‚Œã‚‹"}] },
    ];
    const PRODUCTS = {
      A:{ name:"ã‚´ãƒªãƒ©ã®ã²ã¨ã¤ã‹ã¿ï¼ˆãµãã‚‰ã¯ãã‚±ã‚¢ï¼‰", tagline:"è„šãŒè»½ããªã‚‹ã¨ã€çœ ã‚Šã¯æ·±ããªã‚‹ã€‚", type:"ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å¿«çœ ã‚¿ã‚¤ãƒ—",
         url:"https://e-doshisha.com/hanako/gorilla_hitotsukami/"},
      B:{ name:"ã‚´ãƒªãƒ©ã®ã²ã¨ã¤ãï¼ˆè¶³ã†ã‚‰ã‚±ã‚¢ï¼‰", tagline:"ãƒ„ãƒœã‚’ã˜ã‚“ã‚ã‚Šã€è‡ªç„¶ã«ã¨ã‚ã‘ã‚‹å…¥çœ ã«ã€‚", type:"ãƒªãƒ©ãƒƒã‚¯ã‚¹å¿«çœ ã‚¿ã‚¤ãƒ—",
         url:"https://e-doshisha.com/hanako/gorilla_hitotsuki/"},
      C:{ name:"ã‚´ãƒªãƒ©ã®æ¡æ‰‹ï¼ˆæ‰‹ã‚±ã‚¢ï¼‰", tagline:"ã¬ãã‚‚ã‚Šã®å®‰å¿ƒæ„Ÿã§ã€ã™ã£ã¨å¤¢ã®ä¸­ã¸ã€‚", type:"å®‰å¿ƒå¿«çœ ã‚¿ã‚¤ãƒ—",
         url:"https://e-doshisha.com/hanako/gorilla_akushu/"},
    };

    // ====== è¦ç´  ======
    const stage = document.getElementById("stage");
    const bar = document.getElementById("bar");
    const statusEl = document.getElementById("status");
    const copyBtn = document.getElementById("copy");
    const resetBtn = document.getElementById("reset");
    const foot = document.getElementById("foot");

    // ====== åˆæœŸçŠ¶æ…‹ ======
    let showIntro = true;
    const qs = new URLSearchParams(location.search);
    const preset = (qs.get("a") || qs.get("answers") || "").toUpperCase();
    const answers = {};
    if (preset) [...preset].forEach((ch, i)=>{ if("ABC".includes(ch)) answers[QUESTIONS[i].id]=ch; });
    let step = Object.keys(answers).length;

    // ====== å…±é€šé–¢æ•° ======
    function chooseResult(ans){
      const count = {A:0,B:0,C:0};
      Object.values(ans).forEach(k=>count[k]++);
      const max = Math.max(count.A, count.B, count.C);
      const cands = ["A","B","C"].filter(k=>count[k]===max);
      if (cands.length>1){
        for(const q of QUESTIONS){ const k = ans[q.id]; if(cands.includes(k)) return k; }
      }
      return cands[0];
    }
    const enc = (ans)=> QUESTIONS.map(q=>ans[q.id]||"").join("");
    function syncUrl(){
      const code = enc(answers);
      const n = new URL(location.href);
      if (code) n.searchParams.set("a", code); else n.searchParams.delete("a");
      history.replaceState({}, "", n.toString());
    }

    // ====== ç”»é¢æç”» ======
    function renderIntro(){
      statusEl.textContent = "";
      bar.style.display="none";
      foot.style.display="none";
      stage.innerHTML = `
        <div class="center" style="padding:32px 16px;">
          <div class="intro-hero" aria-hidden="true">ğŸ‰ğŸ¦ğŸ‚ğŸ’¤âœ¨</div>
          <h2 style="font-size:28px;margin:14px 0;">ã‚ãã•ã‚“ Happy Birthdayï¼</h2>
          <p style="line-height:1.8;margin:14px 0;" class="muted">
            ç¡çœ ãŒå¿«é©ã ã¨å¬‰ã—ã„ãªã¨èãã¾ã—ãŸã®ã§ã€<br>
            å¿ƒç†ã‚¯ã‚¤ã‚ºã‚’ã‚‚ã¨ã«ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’æ±ºã‚ã‚‰ã‚ŒãŸã‚‰ã¨æ€ã„ã¾ã™ï½ï¼<br>
            ã»ã‹ã®ã¿ãªã•ã‚“ã‚‚ãœã²å¿ƒç†ãƒ†ã‚¹ãƒˆãŠæ¥½ã—ã¿ãã ã•ã„ï¼
          </p>
          <button id="startBtn" class="btn btn-primary" style="font-size:18px;padding:12px 28px;border-radius:14px;">
            ã‚¹ã‚¿ãƒ¼ãƒˆ
          </button>
        </div>`;
      document.getElementById("startBtn").addEventListener("click", ()=>{
        showIntro=false;
        bar.style.display="block";
        foot.style.display="flex";
        renderQuestion(0);
      });
    }

    function renderQuestion(i){
      statusEl.textContent = `Q${i+1} / ${QUESTIONS.length}`;
      bar.value = i+1;
      stage.innerHTML = `
        <div class="qtitle">${QUESTIONS[i].title}</div>
        <div class="grid">
          ${QUESTIONS[i].choices.map(c=>`
            <button class="choice" data-k="${c.key}">
              <div class="ckey">${c.key}</div>
              <div class="label">${c.label}</div>
            </button>`).join("")}
        </div>`;
      stage.querySelectorAll(".choice").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          answers[QUESTIONS[i].id] = btn.dataset.k;
          step++;
          if (step>=QUESTIONS.length) return renderResult();
          renderQuestion(step);
          syncUrl();
        });
      });
    }

    function renderResult(){
      const key = chooseResult(answers);
      const p = PRODUCTS[key];
      statusEl.textContent = "çµæœ";
      bar.value = bar.max;
      stage.innerHTML = `
        <div class="center result">
          <div style="font-size:46px" aria-hidden="true">ğŸ¦âœ¨</div>
          <h2>ã‚ãªãŸã¯ã€Œ${p.type}ã€</h2>
          <p>ãŠã™ã™ã‚ï¼š<strong>${p.name}</strong></p>
          <p class="muted">${p.tagline}</p>
          <p class="center" style="margin-top:12px">
            <a class="cta" href="${p.url}" target="_blank" rel="noreferrer">å•†å“ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚‹</a>
          </p>
          <div class="muted" style="font-size:12px;margin-top:8px;">
            URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€Œ?a=ABCã€ã§çµæœã‚’å†ç¾ã§ãã¾ã™ï¼ˆä¾‹ï¼šA=Q1ã€B=Q2ã€C=Q3ï¼‰ã€‚
          </div>
        </div>`;
      syncUrl();
    }

    // ====== åˆæœŸè¡¨ç¤º ======
    const copyBtnEl = document.getElementById("copy");
    const resetBtnEl = document.getElementById("reset");
    copyBtnEl.addEventListener("click", async ()=>{
      try { await navigator.clipboard.writeText(location.href); alert("ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); }
      catch { prompt("ã‚³ãƒ”ãƒ¼ã§ããªã„å ´åˆã¯æ‰‹å‹•ã§é¸æŠã—ã¦ãã ã•ã„", location.href); }
    });
    resetBtnEl.addEventListener("click", ()=>{
      location.href = location.pathname; // ã‚¯ã‚¨ãƒªã‚‚ã‚¯ãƒªã‚¢ã—ã¦æœ€åˆã‹ã‚‰
    });

    if (showIntro) renderIntro();
  </script>
</body>
</html>

